CXX             := '$(TARGET_TOOLCHAIN_ROOT)$(TARGET_TOOLCHAIN_PREFIX)g++'
CC              := '$(TARGET_TOOLCHAIN_ROOT)$(TARGET_TOOLCHAIN_PREFIX)gcc'
AR              := '$(TARGET_TOOLCHAIN_ROOT)$(TARGET_TOOLCHAIN_PREFIX)ar' 

RM = rm -f

ARFLAGS := -csr

SRCS := \
$(TFLITE_MICRO_PATH)/tensorflow/lite/micro/simple_memory_allocator.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/debug_log.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/mock_micro_graph.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/micro_error_reporter.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/micro_allocator.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/all_ops_resolver.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/memory_helpers.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/test_helpers.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/micro_time.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/recording_micro_allocator.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/recording_simple_memory_allocator.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/micro_string.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/micro_profiler.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/micro_utils.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/system_setup.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/micro_graph.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/micro_interpreter.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/memory_planner/linear_memory_planner.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/memory_planner/greedy_memory_planner.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/c/common.c $(TFLITE_MICRO_PATH)/tensorflow/lite/core/api/error_reporter.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/core/api/flatbuffer_conversions.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/core/api/op_resolver.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/core/api/tensor_utils.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/kernels/internal/quantization_util.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/kernels/kernel_util.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/schema/schema_utils.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/activations.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/add.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/add_n.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/arg_min_max.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/batch_to_space_nd.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/cast.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/ceil.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/circular_buffer.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/comparisons.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/concatenation.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/conv.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/conv_common.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/cumsum.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/depth_to_space.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/depthwise_conv.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/depthwise_conv_common.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/dequantize.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/detection_postprocess.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/elementwise.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/elu.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/ethosu.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/exp.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/expand_dims.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/fill.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/floor.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/floor_div.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/floor_mod.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/fully_connected.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/fully_connected_common.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/gather.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/gather_nd.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/hard_swish.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/if.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/kernel_runner.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/kernel_util.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/l2norm.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/l2_pool_2d.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/leaky_relu.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/logical.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/logistic.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/log_softmax.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/maximum_minimum.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/mul.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/neg.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/pack.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/pad.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/pooling.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/prelu.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/quantize.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/quantize_common.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/reduce.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/reshape.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/resize_bilinear.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/resize_nearest_neighbor.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/round.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/shape.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/softmax.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/softmax_common.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/space_to_batch_nd.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/split.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/split_v.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/squeeze.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/strided_slice.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/sub.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/svdf.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/svdf_common.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/tanh.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/transpose.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/transpose_conv.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/unpack.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/kernels/zeros_like.cc  $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/examples/hello_world/main.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/examples/hello_world/main_functions.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/examples/hello_world/model.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/examples/hello_world/output_handler.cc $(TFLITE_MICRO_PATH)/tensorflow/lite/micro/examples/hello_world/constants.cc libmicroai.cc

OBJS := \
$(patsubst %.cc,%.o,$(patsubst %.c,%.o,$(SRCS)))

LIBRARY_OBJS := $(filter-out tensorflow/lite/micro/examples/%, $(OBJS))

CXXFLAGS += -std=c++11 -fno-rtti -fno-exceptions -fno-threadsafe-statics -Werror -fno-unwind-tables -ffunction-sections -fdata-sections -fmessage-length=0 -DTF_LITE_STATIC_MEMORY -DTF_LITE_DISABLE_X86_NEON -O3 -Wsign-compare -Wdouble-promotion -Wshadow -Wunused-variable -Wmissing-field-initializers -Wunused-function -Wswitch -Wvla -Wall -Wextra -Wstrict-aliasing -Wno-unused-parameter -DLINUX -DTF_LITE_USE_CTIME -I. -I$(TFLITE_MICRO_PATH) -I$(TFLITE_MICRO_PATH)/third_party/gemmlowp -I$(TFLITE_MICRO_PATH)/third_party/flatbuffers/include -I$(TFLITE_MICRO_PATH)/third_party/ruy
CCFLAGS +=  -Wimplicit-function-declaration -std=c11 -Werror -fno-unwind-tables -ffunction-sections -fdata-sections -fmessage-length=0 -DTF_LITE_STATIC_MEMORY -DTF_LITE_DISABLE_X86_NEON -O3 -Wsign-compare -Wdouble-promotion -Wshadow -Wunused-variable -Wmissing-field-initializers -Wunused-function -Wswitch -Wvla -Wall -Wextra -Wstrict-aliasing -Wno-unused-parameter -DLINUX -DTF_LITE_USE_CTIME -I. -I$(TFLITE_MICRO_PATH) -I$(TFLITE_MICRO_PATH)/third_party/gemmlowp -I$(TFLITE_MICRO_PATH)/third_party/flatbuffers/include -I$(TFLITE_MICRO_PATH)/third_party/ruy

MICROAI_LIB = libmicroai.a

%.o: %.cc
	$(CXX) $(CXXFLAGS) -c $< -o $@

%.o: %.c
	$(CC) $(CCFLAGS) -c $< -o $@

$(MICROAI_LIB): $(LIBRARY_OBJS)
	$(AR) $(ARFLAGS) $(MICROAI_LIB) $(LIBRARY_OBJS)

all: $(MICROAI_LIB)

clean:
	-$(RM) $(OBJS)
	-$(RM) ${MICROAI_LIB}
